---
import { getCollection } from 'astro:content'
import BaseLayout from '../../layouts/BaseLayout.astro'

// Get all posts and extract tags with counts
const allPosts = await getCollection('blog')
const tagCounts = new Map()

allPosts
  .filter((post) => !post.data.draft)
  .forEach((post) => {
    post.data.tags.forEach((tag) => {
      tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1)
    })
  })

// Sort tags by count (descending), then alphabetically
const sortedTags = Array.from(tagCounts.entries()).sort((a, b) => {
  if (b[1] !== a[1]) return b[1] - a[1] // Sort by count descending
  return a[0].localeCompare(b[0]) // Then alphabetically
})
---

<BaseLayout title="All Tags" description="All tags used in posts">
  <div class="mx-auto max-w-3xl px-4 py-12">
    <!-- Simple header like mckerlie -->
    <p class="mb-8  dark:text-gray-300">All the tags used in posts.</p>

    <!-- Tags inline list - matching mckerlie.com format -->
    <div class="space-y-2 text-base">
      {
        sortedTags.map(([tag, count], index) => (
          <>
            <a
              href={`/blog/tag/${tag}/`}
              class="inline-block mr-4 mb-3 text-[#0969da] dark:text-[#4692e0] no-underline hover:underline hover:decoration-dashed hover:underline-offset-4"
            >
              {tag} ({count})
            </a>
            {index < sortedTags.length - 1 && <span class="opacity-70 dark:opacity-60 mr-4">  </span>}
          </>
        ))
      }
    </div>
  </div>
</BaseLayout>
